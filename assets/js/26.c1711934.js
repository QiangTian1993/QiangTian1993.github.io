(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{559:function(t,s,e){"use strict";e.r(s);var a=e(4),n=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"http-缓存"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#http-缓存"}},[t._v("#")]),t._v(" HTTP 缓存")]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",[t._v("POST 请求不会被缓存")])]),t._v(" "),e("h2",{attrs:{id:"强缓存"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#强缓存"}},[t._v("#")]),t._v(" 强缓存")]),t._v(" "),e("p",[t._v("强缓存是指如果服务器发现响应头中设置了 "),e("code",[t._v("Cache-Control")]),t._v(" 或 "),e("code",[t._v("Expires")]),t._v(" 并且缓存还未过期，就会直接读取本地缓存文件不会再去请求服务器\n如果服务端在响应头中设置了 "),e("code",[t._v("Cache-Control")]),t._v(" 在规定时间内前端将不会向服务端发起请求，而直接去读取缓存；因此可以加快访问速度")]),t._v(" "),e("p",[t._v("如果满足强缓存的条件，network -> size 会显示 "),e("code",[t._v("disk cache")])]),t._v(" "),e("p",[e("code",[t._v("Cache-Control")]),t._v(" 常见的值有:")]),t._v(" "),e("ul",[e("li",[t._v("max-age=xxxx 缓存有效时间精确到秒")]),t._v(" "),e("li",[t._v("public 表示可以被浏览器和代理服务器缓存")]),t._v(" "),e("li",[t._v("private 只让客户端可以缓存该资源；代理服务器不缓存")]),t._v(" "),e("li",[t._v("immutable 直接读取缓存，如果不设置这个值，用户刷新时会走协商缓存")]),t._v(" "),e("li",[t._v("no-cache 不做强缓存")]),t._v(" "),e("li",[t._v("no-store 不做强缓存和协商缓存")])]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("response"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Cache-Control'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Max-age: 315360000'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("blockquote",[e("p",[e("code",[t._v("Max-age")]),t._v(" 设置的时间已秒为单位")])]),t._v(" "),e("p",[t._v("除了 "),e("code",[t._v("Cache-Control")]),t._v(" 可以实现强缓存还可以使用 "),e("code",[t._v("Expires")])]),t._v(" "),e("blockquote",[e("p",[t._v("Expires 设置的到期日期是本地时间，所以不靠谱；而且设置了 Cache-Control，Expires 将会被忽略")])]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("response"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Expires'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Wed, 21 Oct 2015 07:28:00 GMT'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("div",{staticClass:"custom-block tip"},[e("p",[t._v("Cache-Control 可以同时设置多个属性，但是如果属性突出，比如同时设置了 public，no-store，最终会以后面的为主")])]),t._v(" "),e("h3",{attrs:{id:"更新资源"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#更新资源"}},[t._v("#")]),t._v(" 更新资源")]),t._v(" "),e("ul",[e("li",[t._v("在 URL 后面加查询参数，比如：url/?v=1.0")]),t._v(" "),e("li",[t._v("更改 URL")]),t._v(" "),e("li",[t._v("更改文件名")])]),t._v(" "),e("h2",{attrs:{id:"协商缓存"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#协商缓存"}},[t._v("#")]),t._v(" 协商缓存")]),t._v(" "),e("p",[t._v("如果缓存时间过了就会向服务器发送请求确认资源是否有更新，因此每次都要发送请求\n实现协商缓存可以通过设置两种 HTTP Header")]),t._v(" "),e("ul",[e("li",[t._v("ETag")]),t._v(" "),e("li",[t._v("LastModified")])]),t._v(" "),e("p",[e("code",[t._v("ETag")]),t._v(" 是基于 "),e("code",[t._v("md5")]),t._v(" 摘要算法的，如果发现文件计算出来的字符串与之前一样就不下载资源")]),t._v(" "),e("p",[t._v("如果满足协商缓存条件，服务器就会返回 "),e("code",[t._v("304")]),t._v(", 告诉浏览器文件没有发生变化可以读取缓存\n如果不满足协商缓存的条件，服务器就会返回 "),e("code",[t._v("200")]),t._v(" 并返回资源返回")]),t._v(" "),e("p",[t._v("第一次请求资源时，服务器在 response header 中添加 "),e("code",[t._v("Last-Modified")]),t._v(" 表示资源在服务器上最后更新的时间。浏览器在下次请求时会将 "),e("code",[t._v("Last-Modified")]),t._v(" 的值添加到 request header "),e("code",[t._v("if-Modified-Since")]),t._v(" 中，服务器收到请求后会和服务器中这个资源最后更新时间作为对比，如果一样就返回 304, 否则返回 200 和资源。这种方法的缺点在于 "),e("code",[t._v("Last-Modified")]),t._v(" 只能以秒计时，如果短时间内资源被修改多次，不会正确返回资源；而且如果打开本地资源文件也会导致 Last-Modified 被修改")]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("response"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ETag'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fileMd5"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("推荐阅读")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://mp.weixin.qq.com/s/IYN0ZuhA8i5n_8yoWLHZvg",target:"_blank",rel:"noopener noreferrer"}},[t._v("「 面试三板斧 」之缓存 (上)"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://mp.weixin.qq.com/s/z9CgJYyDh8BAbxoWx3swrA",target:"_blank",rel:"noopener noreferrer"}},[t._v("「 面试三板斧 」之缓存 (下)"),e("OutboundLink")],1)])])])])}),[],!1,null,null,null);s.default=n.exports}}]);